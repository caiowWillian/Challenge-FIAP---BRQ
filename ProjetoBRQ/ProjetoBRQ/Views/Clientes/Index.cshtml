@model ProjetoBRQ.Models.Cliente
@{
    ViewBag.Title = "Index";
}

<style>
    .paged {
        border: 1px solid black;
        padding: 3px;
    }
</style>

<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Modal Header</h4>
            </div>
            <div class="modal-body">
                <p>Você deseja deletar a noticia?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div id="content" class="col-md-12">

    @Html.ActionLink("Cadastrar Clientes","Create","Clientes", new { @class = "btn btn-default" })

    <table id="table" class="table table-bordered table-hover table-striped">
        <tr>
            <td>@Html.TextBoxFor(m => m.Id, new { @class = "form-control" })</td>
            <td>@Html.TextBoxFor(m => m.Cpf, new { @class = "form-control" })</td>
            <td>@Html.TextBoxFor(m => m.Nome, new { @class = "form-control" })</td>
            <td>@Html.TextBoxFor(m => m.Email, new { @class = "form-control" })</td>
        </tr>
        <tr id="head">
            <td>@Html.LabelFor(m => m.Id)</td>
            <td>@Html.LabelFor(m => m.Cpf)</td>
            <td>@Html.LabelFor(m => m.Nome)</td>
            <td>@Html.LabelFor(m => m.Email)</td>
            <td>Ações</td>
        </tr>
    </table>
    <p class="text-center"><i id="load" class="fa fa-spinner fa-spin" style="font-size:54px"></i></p>
</div>
<div id="page"></div>
<script>
    initTable()
    $('#Id').keypress(function (e) {
        enterPress(e);
    });

    $('#Cpf').keypress(function (e) {
        enterPress(e);
    });

    $('#Nome').keypress(function (e) {
        enterPress(e);
    });

    $('#Email').keypress(function (e) {
        enterPress(e);
    });

    $(document).on('click', '.paged', function () {

        var id = $(this).attr('id').split('-')[1];
        $(".dynamic").remove();
        $('#load').css('display', 'inline-block');
        $.ajax({
            type: "GET",
            url: `@Url.Action("TableIndex", "Clientes")?Page=null&Id=${$('#Id').val()}&Cpf=${$("#Cpf").val()}&Nome=${$("#Nome").val()}&Email=${$("#Email").val()}`,
            dataType: "json",
            success: function (data) {
                createTable(data);
                $('#load').css('display', 'none');
            }
        });
    });

    $(document).on('click', '.delete', function () {
        $('.modal-body').append(`<a class='btn btn-default' href="@Url.Action("Delete","Clientes")/${$(this).attr('id').split('-')[1]}">isso ai</a>`)
    });

    function enterPress(e) {
        if (e.which == 13) {
            initTable();
            $(this).blur();
        }
    }

    function initTable() {
        $(".dynamic").remove();
        $(".paged").remove();
        $.ajax({
            type: "GET",
            url: `@Url.Action("TableIndex", "Clientes")?Page=null&Id=${$('#Id').val()}&Cpf=${$("#Cpf").val()}&Nome=${$("#Nome").val()}&Email=${$("#Email").val()}`,
            dataType: "json",
            success: function (data) {
                createTable(data);
                createPaged(data);
                $('#load').css('display', 'none');
            }
        });
    }

    function createPaged(data) {
        var html = '';

        for (var i = 1; i <= data.countPages; i++) {
            html += `<a class='paged' href='#' id="paged-${i}">${i}</a>`;
        }
        $('#page').append(html);
    }

    function createTable(data) {
        var table = '';
        for (var i = 0; i < data.list.length; i++) {
            table += '<tr class="dynamic">';
            table += `<td> ${data.list[i].Id}</td>`;
            table += `<td> ${data.list[i].Cpf}</td>`;
            table += `<td> ${data.list[i].Nome}</td>`;
            table += `<td> ${data.list[i].Email}</td>`;
            table += '<td>';
            table += `<a href="@Url.Action("Details","Clientes")/${data.list[i].Id}"><i class="fa fa-info" aria-hidden="true" style='color:black'></i></a>&nbsp&nbsp`;
            table += `<a href="@Url.Action("Edit", "Clientes")/${data.list[i].Id}"><i class="fa fa-pencil" aria-hidden="true" style='color:black'></i></a>&nbsp&nbsp`;
            table += `<a href='#' class='delete' id='delete-${data.list[i].Id}' data-toggle='modal' data-target='#myModal'><i class="fa fa-trash-o" aria-hidden="true" style='color:black'></i></a>&nbsp&nbsp`
            table += '</td>';
            table += '</tr>';
        }
        $('#table').append(table);
    }
</script>

<h2>Index</h2>